<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>

  <meta charset="UTF-8">

  <title>实时观点</title>

    <link rel="stylesheet" href="static/chat_style.css" media="screen" type="text/css" />

</head>

<body>
<script src='static/jquery.js'></script>

<script>
$.ajaxSetup({//async:false,
    data: {
        csrfmiddlewaretoken: '{{ csrf_token }}'
    },
});
updateMsg();

setInterval("updateMsg()", 6000); //每秒更新一次              
//更新消息 
pid = 0;
function updateMsg() {
    if (typeof($(".chattxt").last().attr("pid")) == "undefined") {
        pid = 0;
    } else {
        pid = $(".chattxt").last().attr("pid");
    }
    url = "/getChatList/?pid=" + pid; //
    $.get(url,
    function(data) {
        $('.chat-thread').append(data); //解析返回的 xml
        if (data != ""){
        setTimeout(function(){
            $('.chat-thread')[0].scrollTop = $('.chat-thread')[0].scrollHeight;
            }, 300);
            }
    });
    
}
</script>


<ul class="chat-thread">



</ul>

</body>

</html>

